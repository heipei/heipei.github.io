<!DOCTYPE html>
<html xmlns="https://www.w3.org/1999/xhtml" xml:lang="en" lang="en-gb">
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <title>Using hpfriends - the social data-sharing platform</title>
        <meta name="author" content="Johannes Gilger" />
        <link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Atom feed">
        <link rel="stylesheet" href="/css/syntax.css" type="text/css" media="all" />
        <link rel="stylesheet" href="/css/screen.css" type="text/css" media="all" />
        <link rel="canonical" href="https://heipei.github.io/2013/05/11/Using-hpfriends-the-social-data-sharing-platform/" />
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
             (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
             m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
             })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-40830475-1', 'github.io');
            ga('send', 'pageview');
        </script>
    </head>
    <body>
        <div class="header">
            <div class="site">
                <div class="title"><a href="/">Johannes 'heipei' Gilger</a><div class="block1"></div><div class="block2"></div><div class="block3"></div></div>
            </div>
        </div>
        <div class="site">
            <div id="post">
	<h1>Using hpfriends - the social data-sharing platform</h1>
	<p class="meta">11 May 2013</p>
	<p><em>Abstract</em>: This post introduces the <a href="https://hpfriends.honeycloud.net">hpfriends</a> system, which is a a new sharing model
and web frontend for the hpfeeds data-sharing platform. Readers will learn how to use the hpfriends frontend to publish
and subscribe to data-channels in the hpfeeds system and share their data with other users. There is a <a href="/2013/05/10/The-architecture-behind-hpfriends/">separate
post</a> on the architecture of hpfriends.</p>

<p><strong>TOC</strong>: <a href="#hpfriends">Using hpfriends</a>, <a href="#hpfeeds">using hpfeeds</a> and <a href="#dionaea">using
hpfeeds with dionaea</a>.</p>

<h1 id="introduction">Introduction</h1>

<p><a href="https://github.com/rep/hpfeeds">hpfeeds</a> is a simple publish/subscribe data
sharing model. It was initially created by <a href="https://twitter.com/repmovsb">Mark ‘rep’
Schloesser</a> as a way to carry high-volume
real-time data from different pieces of honeypot software between members of
the Honeynet project. hpfriends is an evolution of the hpfeeds data sharing
model. It uses the same wire protocol and thus maintains
backwards-compatibility with all data sources / sinks.</p>

<p>However, instead of relying on access authorization based on channels,
hpfriends uses a social graph in order to make sharing data even easier and
more natural. This also circumvents some policy issues about which people
should be able to use hpfeeds and who should be allowed onto which channels.</p>

<h1 id="using-hpfriends-a-namehpfriendsnbspa">Using hpfriends <a name="hpfriends"> </a></h1>

<p><img src="/images/menu.png" alt="hpfriends menu" title="hpfriends main menu" />
<br /><small>This is the main menu of hpfriends. It will appear on every page.</small></p>

<p><strong>Shares</strong> display the channels <em>you</em> share with other users and group. <strong>Shared
with you</strong> is data that other users share with you, either directly or via
groups.</p>

<p>You can create and edit permissions for your authkeys under <strong>Authkeys</strong>, while
<strong>Logs</strong> contain information about failed attempts to use your authkeys.</p>

<p>If you click <strong>Groups</strong>, you’ll be able to create groups and see your
memberships in other groups. The <strong>Search</strong> page allows you to quickly search
for channels, log messages and groups.</p>

<h2 id="sharing-data">Sharing data</h2>
<p>This view shows channel names that you currently share with other users and
groups. Click <strong>Add share</strong> to define an additional sharing relationship.</p>

<p><img src="/images/shares.png" alt="hpfriends shares" title="hpfriends shares" />
<br /><small>Currently shared channels.</small></p>

<p>The <em>Type</em> field specifies whether you only want to share data generated by
yourself for that channel name or if you also want to redistribute data on that
channel which you received from other users. Use the search-field above the
select menu for users to filter for usernames.</p>

<p><img src="/images/add_share.png" alt="hpfriends shares" title="hpfriends add share" />
<br /><small>Adding a new share.</small></p>

<h2 id="accepting-data">Accepting data</h2>

<p>If other users share data channels with you, these shares will appear under
<strong>Shared with you</strong>.</p>

<p><img src="/images/incoming_shares.png" alt="hpfriends incoming shares" title="hpfriends incoming shares" />
<br /><small>Data shared by other users.</small></p>

<p>This view shows that there are two channels currently shared with me directly.
I have activated the channel <code>mobile.malware</code> and could now receive and forward
messages by this user on this channel. Since I am not interested in receiving
data by user <em>leacab</em> on channel <code>fooo</code>, I didn’t activate it.</p>

<h2 id="authkeys">Authkeys</h2>

<p>If you want to publish and subscribe to data channels you have to add authkeys.
The <strong>Authkeys</strong> view shows one of my authkeys. It has different permission for
publishing and subscribing, along with statistics about messages and bytes sent
and received. Authkeys should be used as single-purpose tokens for different
pieces of backend software, with the smallest necessary amount of privileges.
This will reduce the impact if one of your sensors is compromised.</p>

<p><img src="/images/authkeys.png" alt="hpfriends authkeys" title="hpfriends authkeys" />
<br /><small>List and statistics of authkeys.</small></p>

<h2 id="groups">Groups</h2>

<p>Groups can be used to conveniently group and subsequently share data with a
number of people. Currently, the group-functionality is somewhat limited. It is
not possible to leave groups or to remove members.</p>

<p><img src="/images/groups.png" alt="hpfriends groups" title="hpfriends groups" /></p>

<h2 id="logs">Logs</h2>

<p>The logs will contain error messages which arise when you misuse your authkeys.
Check the logs first if you’re having problems publishing and subscribing to a
channel.</p>

<p><img src="/images/logs.png" alt="hpfriends logs" title="hpfriends logs" />
<br /><small>Log messages indicate possible error sources with authkeys.</small></p>

<h1 id="using-hpfeeds-a-namehpfeedsnbspa">Using hpfeeds <a name="hpfeeds"> </a></h1>

<p>At the end of the day, you want to use hpfeeds to publish your data and
subscribe to data channels. This is where the hpfeeds cli tools come in. This
section will show you how to use the tools in combination with hpfriends.</p>

<h2 id="hpfeeds---python-implementation">hpfeeds - python implementation</h2>

<p>The <a href="https://github.com/rep/hpfeeds">“reference” hpfeeds implementation</a> was created by Mark and should be used in most cases. Simply get the source code from GitHub, no setup necessary.</p>

<p>There is small tool which you can use to manually publish and subscribe to channels. It is located in the <code>cli</code> folder and can be used as follows:</p>

<p><code>hpfeeds-client -i ident -s secret --host host -p port -c channel1 [-c channel2, ...] 'action' [&lt;data&gt;]</code></p>

<p>Where ‘action’ can be <code>publish</code> or <code>subscribe</code>.</p>

<p>Looking at our list of authkeys above, we could use our key to publish to channel random.int:</p>

<p><code>hpfeeds-client --host hpfriends.honeycloud.net -p 20000 -i zNKeYNK -s KwxHqvJ -c random.int publish "42"</code></p>

<p>We could also subscribe to one of the channels which our authkey has permissions to:</p>

<p><code>hpfeeds-client --host hpfriends.honeycloud.net -p 20000 -i zNKeYNK -s KwxHqvJ -c geoloc.response subscribe</code></p>

<h1 id="using-hpfeeds-with-dionaea-a-namedionaeanbspa">Using hpfeeds with dionaea <a name="dionaea"> </a></h1>

<p>One of the sensors that supports hpfeeds is dionaea - the most modern low-interaction server honeypot. This software is
also the source for most events currently showing up on the <a href="https://map.honeynet.org">HoneyMap</a>. Sadly the hpfeeds module is not part of the
official git repository, so we need to make a small change to its setup steps.</p>

<p>To setup dionaea you need to follow the official setup instructions
(<a href="https://dionaea.carnivore.it/#compiling">dionaea.carnivore.it</a>) and then use the git URL
<code>git://github.com/rep/dionaea.git</code> instead of the normal dionaea one. This will include the hpfeeds module and the
appropriate config section in the honeypot. After it compiled correctly and you installed dionaea on your system, you
need to edit the <code>dionaea.conf</code> file and enter your hpfeeds credentials, as well as enable the module. You get the
authkey credentials by creating some in the hpfriends webinterface. The following is how the needed config sections look
like:</p>

<p><code>dionaea.conf</code></p>

<pre><code>     hpfeeds = {
       hp1 = {
         server = "hpfriends.honeycloud.net"
         port = "10000"
         ident = "&lt;your_authkey_identifier&gt;"
         secret = "&lt;your_authkey_secret&gt;"
         // dynip_resolve: enable to lookup the sensor ip through a webservice
         dynip_resolve = "https://hpfriends.honeycloud.net/ip"
       }
     }
...
     ihandlers = {
...
//    "submit_http",
      "hpfeeds",
//    "logxmpp",
...
</code></pre>

<p>Remember to also give your authkey the necessary access rights. It needs to be able to publish on the channels
dionaea.capture, dionaea.shellcodeprofiles, dionaea.dcerpcrequests and mwbinary.dionaea.sensorunique.</p>

<p>After this is done you can start the honeypot and your captured attacks should be appearing on the hpfriends
“dionaea.capture” channel. If you share this channel with Mark or the Honeynet Project in general and tell Mark about
it, then he can also make your captured attacks on the HoneyMap with one click in the hpfriends interface.</p>

<h1 id="further-reading">Further reading</h1>

<p>hpfriends is maintained by <a href="https://twitter.com/repmovsb">Mark ‘rep’ Schloesser</a> and <a href="https://twitter.com/heipei">Johannes ‘heipei’ Gilger</a></p>

<ul>
  <li><a href="https://hpfriends.honeycloud.net">hpfriends</a> - the hpfriends website</li>
  <li><a href="https://github.com/rep/hpfeeds">hpfeeds</a> - hpfeeds GitHub repo</li>
  <li><a href="https://github.com/vicvega/hpfeeds-ruby">hpfeeds-ruby</a> - Ruby gem for hpfeeds</li>
  <li><a href="https://github.com/fw42/go-hpfeeds">go-hpfeeds</a> - Go implementation of hpfeeds</li>
  <li><a href="https://honeynet.org/">Honeynet</a> - The Honeynet Project</li>
  <li><a href="https://map.honeynet.org/">HoneyMap</a> - The HoneyMap, which uses hpfeeds</li>
</ul>

</div>
<!--

<div id="related">
  <h2>Related Posts</h2>
  <ul class="posts">
    
      <li><span>28 May 2016</span> <span class="seperator">~</span> <a href="/2016/05/28/jekyll-and-responsive-flickr-photos/">Jekyll and responsive Flickr photos</a></li>
    
      <li><span>23 Sep 2015</span> <span class="seperator">~</span> <a href="/2015/09/23/nginx-sso-Simple-offline-SSO-for-nginx/">nginx-sso - Simple offline SSO for nginx</a></li>
    
      <li><span>20 Aug 2015</span> <span class="seperator">~</span> <a href="/2015/08/20/Persistent-AppCache-Injections/">Persistent AppCache Injections</a></li>
    
  </ul>
</div>

-->
<div class="comments">
	<h3>Comments</h3>
        <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'heipei'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    

</div>

            <div class="footer">
                <div class="contact">
                    <p>Johannes Gilger - <a href="https://twitter.com/heipei/">@heipei</a></p>
                </div>
                <div class="rss">
                    <i class="icon-rss"></i> <a href="/atom.xml">Atom Feed</a>
                </div>
            </div>
        </div>
    </body>
    <html>
