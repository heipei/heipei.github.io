---
layout: post
title: Using hpfriends - the social data-sharing platform
---

*Abstract*: This blog post introduces the
[hpfriends](http://hpfriends.honeycloud.net) platform, a replacement for the
aging hpfeeds web frontend. Readers will learn <a href="#use">how to use</a>
the new hpfriends web frontend. There is also a section on the <a
href="#arch">architecture</a> of the hpfriends platform.

Introduction
============

[hpfeeds](https://github.com/rep/hpfeeds) is a simple publish/subscribe data
sharing model. It was initially created by [Mark 'rep'
Schloesser](https://twitter.com/repmovsb) as a way to carry high-volume
real-time data from different pieces of honeypot software between members of
the Honeynet project. hpfriends is an evolution of the hpfeeds data sharing
model. It uses the same wire protocol and thus maintains
backwards-compatibility with all data sources / sinks.

However, instead of relying on access authorization based on channels,
hpfriends uses a social graph in order to make sharing data even easier and
more natural. This also circumvents some policy issues about which people
should be able to use hpfeeds and who should be allowed onto which channels.


Using hpfriends <a name="use">&nbsp;</a>
===============

![hpfriends menu](/images/menu.png "hpfriends main menu")
<br/><small>This is the main menu of hpfriends. It will appear on every page.</small>

**Shares** display the channels *you* share with other users and group. **Shared
with you** is data that other users share with you, either directly or via
groups.

You can create and edit permissions for your authkeys under **Authkeys**, while
**Logs** contain information about failed attempts to use your authkeys. 

If you click **Groups**, you'll be able to create groups and see your
memberships in other groups. The **Search** page allows you to quickly search
for channels, log messages and groups.

Sharing data
------------
This view shows channel names that you currently share with other users and
groups. Click **Add share** to define an additional sharing relationship.

![hpfriends shares](/images/shares.png "hpfriends shares")
<br/><small>Currently shared channels.</small>

The *Type* field specifies whether you only want to share data generated by
yourself for that channel name or if you also want to redistribute data on that
channel which you received from other users. Use the search-field above the
select menu for users to filter for usernames.

![hpfriends shares](/images/add_share.png "hpfriends add share")
<br/><small>Adding a new share.</small>

Accepting data
--------------

If other users share data channels with you, these shares will appear under
**Shared with you**.

![hpfriends incoming shares](/images/incoming_shares.png "hpfriends incoming shares")
<br/><small>Data shared by other users.</small>

This view shows that there are two channels currently shared with me directly.
I have activated the channel `mobile.malware` and could now receive and forward
messages by this user on this channel. Since I am not interested in receiving
data by user *leacab* on channel `fooo`, I didn't activate it.

Authkeys
--------

If you want to publish and subscribe to data channels you have to add authkeys.
The **Authkeys** view shows one of my authkeys. It has different permission for
publishing and subscribing, along with statistics about messages and bytes sent
and received.

![hpfriends authkeys](/images/authkeys.png "hpfriends authkeys")
<br/><small>List and statistics of authkeys.</small>

Groups
------

Groups can be used to conveniently group and subsequently share data with a
number of people. Currently, the group-functionality is somewhat limited. It is
not possible to leave groups or to remove members. 

![hpfriends groups](/images/groups.png "hpfriends groups")

Logs
----

The logs will contain error messages which arise when you misuse your authkeys.
Check the logs first if you're having problems publishing and subscribing to a
channel.

![hpfriends logs](/images/logs.png "hpfriends logs")
<br/><small>Log messages indicate possible error sources with authkeys.</small>

---

Architecture <a name="arch">&nbsp;</a>
============

Channels in hpfeeds are commonly used to group data of the same origin and
structure. A channel dedicated to data from the dionaea honeypot software can
be expected to carry data adherring to a specific format, suitable for
automated processing. Before hpfriends, channel names were unique and global within
the hpfeeds system. This meant that once a channel was established by a user
(such as `dionaea.captures`), that user had to grant permission each time another
user wanted to publish or subscribe to the channel `dionaea.captures`.

hpfriends
---------

hpfriends uses a social sharing graph as its backend database. That means that
users and groups are represented as *nodes*, while the sharing relationships
are modelled as *edges* between those nodes. Sharing is no binary attribute,
which is why each edge contains a number of attributes, such as the type of the
relationship and the channel name.

![hpfriends graph](/images/graph.png "hpfriends graph")
<br/><small>A (very small) subset of the hpfriends sharing graph.</small>

Channels are no longer global broadcast rooms but rather local decisions. For
each message on a channel and user node, a decision is made whether the channel
can be accessed by other users based on the existence of a sharing relationship
between the original user and other users and groups. Since a channel name can
be used by anyone to publish messages, channels have de-facto become exclusive
mandatory tags for messages.

If user **jojo** has a sharing relationship on channel `dionaea.captures` with
user **mark**, then *mark* will be able to read messages on that channel. Other
user groups might also use the channel name `dionaea.captures`, yet have no
sharing relationships with **jojo** or **mark**. User **mark** may in turn decide to
also share his `dionaea.captures` messages with **jojo**, or even re-distribute the
messages he received from **jojo** to third parties, i.e. other users and groups.
The difference between sharing only messages generated by the user or also
incoming messages by other users is indicated using the `type` attribute.

Authkeys
--------

hpfriends uses Authkeys in the same fashion as the hpfeeds system. In fact, the
hpfriends message broker is backwards-compatible to the hpfeeds tools. Authkeys
are used as single-purpose tokens for different pieces of backend software
which is needed to publish and subscribe to data-channels. Each Authkey has a
list of channels it's allowed to publish and subscribe to.

Further reading
===============

hpfriends is maintained by [Mark 'rep' Schloesser](https://twitter.com/repmovsb) and [Johannes 'heipei' Gilger](https://twitter.com/heipei)

* [hpfriends](http://hpfriends.honeycloud.net) - the hpfriends website
* [hpfeeds](https://github.com/rep/hpfeeds) - hpfeeds GitHub repo
* [Honeynet](http://honeynet.org/) - The Honeynet Project
* [HoneyMap](http://map.honeynet.org/) - The HoneyMap, which uses hpfeeds
