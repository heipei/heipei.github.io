<!DOCTYPE html>
<html xmlns="https://www.w3.org/1999/xhtml" xml:lang="en" lang="en-gb">
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <title>UDF for cross-OS file-transfer using removable media</title>
        <meta name="author" content="Johannes Gilger" />
        <link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Atom feed">
        <link rel="stylesheet" href="/css/syntax.css" type="text/css" media="all" />
        <link rel="stylesheet" href="/css/screen.css" type="text/css" media="all" />
        <link rel="canonical" href="https://heipei.github.io/2014/12/21/UDF-for-cross-OS-file-transfer/" />
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
             (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
             m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
             })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-40830475-1', 'github.io');
            ga('send', 'pageview');
        </script>
    </head>
    <body>
        <div class="header">
            <div class="site">
                <div class="title"><a href="/">Johannes 'heipei' Gilger</a><div class="block1"></div><div class="block2"></div><div class="block3"></div></div>
            </div>
        </div>
        <div class="site">
            <div id="post">
	<h1>UDF for cross-OS file-transfer using removable media</h1>
	<p class="meta">21 Dec 2014</p>
	<h1 id="introduction">Introduction</h1>

<p>Ever since you started using more than one OS you knew the inherent problems of exchanging data between different OSs.
Unless you transfer everything via network, you will have to make a choice regarding the filesystem on a removable
drive.</p>

<p>For this post we consider the common scenario of wanting to move files between Linux, Mac OS and Windows. If you
consider only a subset of these you might get away with other filesystems as well. Each filesystem you choose will have
a number of limitations. Some might be read-only in one or two of the destination OSs, others might have limits on the
filesize (4GB anyone?) and yet others might require you to install closed-sourced commercial software to use them.</p>

<p>Up until recently, I would use FAT32 to exchange files (or backups) between devices. This worked reasonably well, but in
2014 you can expect to have a number of files which exceed FAT32s 4GB limit on filesize. Only think about Virtual
Machine images!</p>

<p>Recently, I stumbled on a surprisingly simple solution for my problem: UDF! Everybody knows and supports UDF (Universal
Disk Format) because it’s the filesystem used on DVDs etc. Reading about UDF, it’s also the filesystem for DVD-RAM (a
relic disk format which could be used to create incremental backups by burning them to a DVD disk). I never thought
about it, but UDF can also be used as a filesystem for read-write media, and current operating systems support it just
fine. To top it of, UDF is both case-sensitive and case-preserving and has POSIX file permissions, not something to take
for granted even with modern filesystems. A tabular feature comparison between UDF, NTFS, FAT32 and exFAT can be found in
the <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ee681827">Windows Dev Center</a>.</p>

<h1 id="creating-a-udf-drive">Creating a UDF drive</h1>

<p>Now, this is the tricky part, and the one where your mileage might vary wildly. Please contact me with any improvements
on these steps. For this I’m assuming that I have a Linux host to create the UDF filesystem and a Mac OS X host to use
it with.</p>

<p>On Linux, install mkudffs (package udftools). Insert the drive you want to format using UDF (sdb in our example).</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">dd <span class="k">if</span><span class="o">=</span>/dev/zero <span class="nv">of</span><span class="o">=</span>/dev/sdb <span class="nv">bs</span><span class="o">=</span>1M <span class="nv">count</span><span class="o">=</span>1
sync
mkudffs --blocksize<span class="o">=</span><span class="m">512</span> --media-type<span class="o">=</span>hd /dev/sdb
sync</code></pre></figure>

<p>Then insert the new drive into your Mac OS machine. It will be mounted as “LinuxUDF”. You can then simply rename the
drive.</p>

<h1 id="mounting-a-udf-drive-at-a-fixed-mount-point-in-mac-os-x">Mounting a UDF drive at a fixed mount point in Mac OS X</h1>

<p>If you use a removable drive on a Mac OS machine frequently (or permanently) it would be nice to mount it at a fixed
location rather than under <tt>/Volume/drivename</tt>. Mac OS still has an fstab-mechanism, but the way to edit the file differs
from Linux. Also, since our UDF does not have a UUID, we will to identify it using a label, so make sure to give a
unique name to each of your UDF-formatted drives.</p>

<p>Eject the UDF drive you renamed in the earlier step. Open the Terminal and start vifs:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">sudo vifs</code></pre></figure>

<p>Add a line like this to the empty fstab file:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">LABEL</span><span class="o">=</span>JF64GB  /Users/jojo/mnt/jf64gb  udf rw,auto</code></pre></figure>

<p>When you insert the drive into your Mac, it will auto-mount at the given mountpoint. It will still show up as a
removable drive on your desktop, and you can still eject it like you did before.</p>

<h1 id="open-problems">Open problems</h1>

<p>First of all, I haven’t actually tested whether the UDF drive I created also works on Windows. But given the age and 
pervasion of the UDF standard, I’d be inclined to chalk it up to Windows if it didn’t work.</p>

<p>My biggest concern with this setup is that there currently is no Open Source platform-interoperable way to do full-disk
encryption (FDE). Ever since Truecrypt shut down, there isn’t even a way to do it between Mac OS and Linux, though both
have very mature FDE solutions builtin. You could use <a href="https://github.com/vgough/encfs">encfs</a> which is a FUSE-based filesystem
which encrypts both the content and the filenames (but leaves the directory structure visible). encfs is availabe in
most Linux distributions and in homebrew.</p>

<h1 id="update---january-2014">Update - January 2014</h1>

<p>I’ve since experienced a scenario where a UDF-drive on my Linux machine
exhibited some really strange behaviour during writes (via rsync for example),
resulting in a 100% CPU load of the process doing the writing. Since I did not
have the time to investigate I simply switched that disk back to ext4 for now.</p>

<h1 id="references">References</h1>

<ul>
  <li><a href="https://osquestions.com/unix-linux/35973/udf-and-fstab-no-uuid">UDF and fstab without UUID</a></li>
  <li><a href="https://tanguy.ortolo.eu/blog/article93/usb-udf">Creating UDF filesystem using mkudffs</a></li>
  <li><a href="https://wiki.archlinux.org/index.php/disk_encryption#compatibility_.26_prevalence">Arch Linux on Disk Encryption</a></li>
</ul>


</div>
<!--

<div id="related">
  <h2>Related Posts</h2>
  <ul class="posts">
    
      <li><span>28 May 2016</span> <span class="seperator">~</span> <a href="/2016/05/28/jekyll-and-responsive-flickr-photos/">Jekyll and responsive Flickr photos</a></li>
    
      <li><span>23 Sep 2015</span> <span class="seperator">~</span> <a href="/2015/09/23/nginx-sso-Simple-offline-SSO-for-nginx/">nginx-sso - Simple offline SSO for nginx</a></li>
    
      <li><span>20 Aug 2015</span> <span class="seperator">~</span> <a href="/2015/08/20/Persistent-AppCache-Injections/">Persistent AppCache Injections</a></li>
    
  </ul>
</div>

-->
<div class="comments">
	<h3>Comments</h3>
        <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'heipei'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    

</div>

            <div class="footer">
                <div class="contact">
                    <p>Johannes Gilger - <a href="https://twitter.com/heipei/">@heipei</a></p>
                </div>
                <div class="rss">
                    <i class="icon-rss"></i> <a href="/atom.xml">Atom Feed</a>
                </div>
            </div>
        </div>
    </body>
    <html>
